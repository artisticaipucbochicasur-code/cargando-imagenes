<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- PWA y Iconos -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="apple-icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DECOM">
    <meta name="theme-color" content="#111111">
    <meta name="mobile-web-app-capable" content="yes">

    <title>DECOM - Multimedia</title>

    <style>
        :root {
            --bg1: #000;
            --bg2: #000;
            --text: #fff;
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg1), var(--bg2));
            font-family: "Segoe UI", Arial, sans-serif;
            color: var(--text);
            overflow: hidden;
        }

        #socialHeader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 10001;
            padding: 8px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 12px;
        }

        .header-content h1 {
            color: white;
            font-size: 1.4rem;
            margin: 0;
            font-weight: 600;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .header-buttons {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .header-btn.selected {
            background: #ffffff;
            color: #111111;
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #111;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            color: #fff;
        }

        .modal-close {
            background: #444;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <header id="socialHeader">
        <div class="header-content">
            <h1>DECOM</h1>
            <div class="header-buttons">
                <button class="header-btn" id="imagesBtn" title="Imágenes">
                    <i class="fas fa-image"></i>
                </button>
                <button class="header-btn selected" id="videosBtn" title="Videos">
                    <i class="fas fa-video"></i>
                </button>
                <button class="header-btn" id="publishBtn" title="Publicar">
                    <i class="fas fa-plus-circle"></i>
                </button>
            </div>
        </div>
    </header>
        <div id="videosModal" class="modal active">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAllModals()">Cerrar</button>
            <div class="swiper">
                <div class="swiper-wrapper" id="slides"></div>
                <div id="video-title-fixed">
                    <div class="video-title"></div>
                    <div class="video-desc"></div>
                </div>
            </div>
            <div class="floating-buttons">
                <button id="btn-delete" class="fab danger"><i class="fas fa-trash"></i></button>
            </div>
            <div class="comments-overlay-container hidden-overlay" id="commentsOverlay">
                <ul id="commentsList"></ul>
            </div>
            <div class="comments-counter hidden-overlay" id="commentsCounter">
                <span class="icon">
                    <i class="fa-regular fa-comment"></i>
                </span>
                <span class="count" id="commentCountValue">0</span>
            </div>
            <div class="comment-input-container hidden-overlay">
                <div class="comment-input-wrapper">
                    <input type="text" id="commentInput" placeholder="Escribe un comentario...">
                    <button class="send-comment-btn"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
            <div id="notification-wrapper">
                <button id="notification-btn">
                    <i class="far fa-bell"></i>
                    <span id="notification-count"></span>
                </button>
                <div id="notification-list" class="hidden"></div>
            </div>
            <button id="refreshBtn" class="refresh-btn" title="Actualizar página">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button id="saveBtn" class="fab" title="Guardar/Ver Guardados">
                <i class="far fa-bookmark"></i>
            </button>
        </div>
    </div>

    <div id="imagesModal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAllModals()">Cerrar</button>
            <h2>Imágenes</h2>
            <p>Aquí se mostrará el carrusel de imágenes (pendiente de implementación).</p>
            <!-- Placeholder para el contenido de imágenes -->
        </div>
    </div>

    <div id="publishModal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAllModals()">Cerrar</button>
            <h3>Publicar Video</h3>
            <input type="text" id="videoTitle" placeholder="Título del video">
            <input type="text" id="videoLink" placeholder="Enlace del video (YouTube o MP4)">
            <textarea id="videoDescription" placeholder="Descripción (opcional)"></textarea>
            <div class="modal-actions">
                <button id="publishSubmit">Publicar</button>
                <button id="publishCancel">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="savedModal" class="modal hidden">
        <div class="modal-content" id="savedModalInner">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 18px;">🔖 Guardados</h2>
                <button id="closeSavedBtn" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            <input id="savedSearchInput" type="text" placeholder="Buscar guardados...">
            <ul id="savedList"></ul>
        </div>
    </div>

    <div id="custom-alert-modal" class="modal hidden">
        <div class="modal-content">
            <h3>¡Atención!</h3>
            <p id="custom-alert-message"></p>
            <div class="modal-actions">
                <button id="custom-alert-ok">Aceptar</button>
            </div>
        </div>
    </div>

    <div id="delete-modal" class="modal hidden">
        <div class="modal-content">
            <h3>¿Eliminar Video?</h3>
            <p id="delete-video-title"></p>
            <div class="modal-actions">
                <button id="delete-confirm">Eliminar</button>
                <button id="delete-cancel">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="loader"><span class="spinner">🔄</span></div>
        <style>
        .swiper {
            width: 100%;
            height: 70vh;
            position: relative;
        }

        .swiper-slide {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: stretch;
            position: relative;
            background: #000;
        }

        .player-card {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            border-radius: 10px;
        }

        .poster {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #111;
            background-size: cover;
            background-position: center center;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        .play-btn {
            display: grid;
            place-items: center;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(2px);
            font-size: 28px;
            line-height: 1;
            border: 2px solid #fff;
        }

        .player-iframe {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            border: 0;
            background: #000;
        }

        .controls-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 5;
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .player-card:hover .controls-bar {
            opacity: 1;
        }

        .center-play-pause-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: grid;
            place-items: center;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.55);
            border: 2px solid #fff;
            color: #fff;
            font-size: 28px;
            cursor: pointer;
            z-index: 6;
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .player-card:hover .center-play-pause-btn {
            opacity: 1;
        }

        .play-pause-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
        }

        .progress-bar {
            flex-grow: 1;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
        }

        .progress {
            height: 100%;
            width: 0%;
            background: #ff0000;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .volume-control input[type="range"] {
            width: 60px;
            -webkit-appearance: none;
            background: transparent;
        }

        .volume-control input[type="range"]::-webkit-slider-runnable-track {
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 1.5px;
        }

        .volume-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #fff;
            margin-top: -4.5px;
        }

        .volume-icon {
            font-size: 20px;
        }

        .time {
            font-size: 12px;
            color: #fff;
        }

            #video-title-fixed {
            position: absolute;
            top: 10px;
            left: 10px;
            width: calc(100% - 20px);
            z-index: 1000;
            background: rgba(0,0,0,0.3);
            transition: opacity 0.18s ease;
            opacity: 1;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 6px 10px;
            border-radius: 6px;
        }

        #video-title-fixed .video-title {
            font-size: 18px;
            font-weight: 600;
            text-align: left;
            color: #f1f1f1;
        }

        #video-title-fixed .video-desc {
            font-size: 14px;
            opacity: 0.85;
            text-align: left;
            color: #ddd;
        }

        #video-title-fixed .text-container {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            transition: -webkit-line-clamp 0.3s ease;
            cursor: pointer;
            position: relative;
            max-height: 4em;
            line-height: 1.2;
        }

        #video-title-fixed .text-container.expanded {
            -webkit-line-clamp: unset;
            cursor: pointer;
            overflow-y: auto;
            max-height: 60vh;
            padding-right: 15px;
        }

        #video-title-fixed .toggle-text {
            color: #ccc;
            font-size: 12px;
            font-weight: bold;
            user-select: none;
            display: inline-block;
            margin-left: 6px;
            cursor: pointer;
        }

        .comments-overlay-container {
            position: absolute;
            bottom: 90px;
            left: 10px;
            width: calc(80% - 20px);
            background: rgba(0, 0, 0, 0.2);
            color: #eee;
            padding: 8px;
            border-radius: 5px;
            box-sizing: border-box;
            z-index: 998;
            overflow-y: auto;
            transition: opacity 0.3s ease, max-height 0.3s ease;
            max-height: 4em;
        }

        .comments-overlay-container.expanded {
            max-height: 50vh;
        }

        .comments-overlay-container ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .comments-overlay-container li {
            font-size: 0.8rem;
            line-height: 1.2;
            margin-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .comments-overlay-container li.deletable {
            cursor: pointer;
        }

        .delete-btn-container {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #e74c3c;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 0;
        }

        .delete-btn {
            color: white;
            font-weight: bold;
            padding: 10px;
            cursor: pointer;
            user-select: none;
        }

        .comment-content.swiped {
            transform: translateX(100px);
        }

        .delete-btn-container.visible {
            transform: translateX(0);
        }

        .hidden-overlay {
            opacity: 0 !important;
            pointer-events: none !important;
            transition: opacity 0.3s;
        }

        .comments-counter {
            position: absolute;
            bottom: 140px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            z-index: 999;
        }

        .comments-counter span#commentCountValue {
            display: none;
            position: absolute;
            bottom: -10px;
            left: -10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 12px;
            font-weight: bold;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .comment-input-container {
            position: absolute;
            bottom: 39px;
            left: 0;
            width: 100%;
            background: transparent;
            padding: 8px 12px;
            box-sizing: border-box;
            z-index: 1000;
        }

        .comment-input-wrapper {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            border-radius: 25px;
            width: 95%;
            margin: 0 auto;
            padding: 4px 8px;
            backdrop-filter: blur(3px);
        }

        .comment-input-wrapper input {
            flex-grow: 1;
            background: transparent;
            border: none;
            outline: none;
            padding: 6px 8px;
            font-size: 0.9rem;
            color: white;
        }

        .comment-input-wrapper button {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 4px 6px;
        }

        #notification-wrapper {
            position: absolute;
            right: 20px;
            bottom: 195px;
            z-index: 5000;
        }

        #notification-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        #notification-list {
            position: absolute;
            top: 55px;
            right: 0;
            background: #222;
            border: 1px solid #444;
            border-radius: 10px;
            width: 260px;
            max-height: 320px;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            display: none;
        }

        #notification-list div {
            padding: 10px;
            border-bottom: 1px solid #333;
            cursor: pointer;
            color: #ddd;
        }

        #notification-list div:hover {
            background: #333;
        }

            .floating-buttons {
            position: absolute;
            bottom: 90px;
            right: 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 2000;
        }

        .fab {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        .refresh-btn {
            position: absolute;
            bottom: 250px;
            right: 18px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            z-index: 2000;
        }

        #loader {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            z-index: 10;
            color: #fff;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.7);
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loader .spinner {
            display: inline-block;
            animation: spin 1.1s linear infinite;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        .modal-actions button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        #publishModal input, #publishModal textarea {
            padding: 8px;
            border: 1px solid #444;
            border-radius: 5px;
            background: #222;
            color: #fff;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu97yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec";
        let swiper = null;
        let players = {};
        let lastVideos = [];
        let notifications = [];
        let comentariosPorVideo = {};
        let ultimaActualizacionComentarios = "";
        let usuarioAutor = "";
        let usuarioCorreo = "";
        let comentariosInterval = null;
        let activeComment = null;
        let startX = 0;
        let isSwiping = false;

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => modal.classList.remove('active'));
            document.querySelectorAll('.header-btn').forEach(btn => btn.classList.remove('selected'));
            if (swiper) {
                swiper.destroy(true, true);
                swiper = null;
            }
            Object.values(players).forEach(player => {
                if (typeof player.pauseVideo === 'function') player.pauseVideo();
                else if (typeof player.pause === 'function') player.pause();
            });
            players = {};
        }

        function openModal(modalId, buttonId) {
            closeAllModals();
            document.getElementById(modalId).classList.add('active');
            document.getElementById(buttonId).classList.add('selected');
            if (modalId === 'videosModal') {
                cargarVideos();
            }
        }

        document.getElementById('imagesBtn').addEventListener('click', () => openModal('imagesModal', 'imagesBtn'));
        document.getElementById('videosBtn').addEventListener('click', () => openModal('videosModal', 'videosBtn'));
        document.getElementById('publishBtn').addEventListener('click', () => openModal('publishModal', 'publishBtn'));

        document.getElementById('custom-alert-ok').onclick = () => {
            document.getElementById('custom-alert-modal').classList.add('hidden');
        };

        document.getElementById('publishCancel').onclick = () => closeAllModals();

        function getEmbedInfo(link) {
            const url = new URL(link, location.href);
            if (url.hostname.includes("youtube.com") || url.hostname.includes("youtu.be")) {
                let videoId = "";
                if (url.hostname.includes("youtube.com")) {
                    videoId = url.searchParams.get("v") || "";
                } else if (url.hostname.includes("youtu.be")) {
                    videoId = url.pathname.replace("/", "");
                }
                if (videoId) {
                    const embedSrc = `https://www.youtube.com/embed/${videoId}?rel=0&playsinline=1&controls=0&modestbranding=1`;
                    const poster = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                    return { type: "youtube", embedSrc, poster, videoId };
                }
            }
            if (url.hostname.includes("archive.org")) {
                let identifier = "";
                const m = link.match(/archive\.org\/(?:embed|details|download)\/([^?&#/]+)/i);
                if (m && m[1]) {
                    identifier = m[1];
                }
                const poster = identifier ? `https://archive.org/services/img/${identifier}` : "";
                return { type: "mp4", embedSrc: link, poster };
            }
            if (url.pathname.endsWith(".mp4")) {
                return { type: "mp4", embedSrc: link, poster: "" };
            }
            return { type: "other", embedSrc: link, poster: "" };
        }

        function createSlide(titulo, link, descripcion, id) {
            const { embedSrc, poster } = getEmbedInfo(link);
            const slide = document.createElement("div");
            slide.className = "swiper-slide";
            slide.dataset.title = titulo || "Video";
            slide.dataset.descripcion = descripcion || "";
            slide.dataset.videoid = id || "";

            const card = document.createElement("div");
            card.className = "player-card";
            card.dataset.embed = embedSrc;

            const posterEl = document.createElement("div");
            posterEl.className = "poster";
            if (poster) posterEl.style.backgroundImage = `url("${poster}")`;

            const playBtn = document.createElement("div");
            playBtn.className = "play-btn";
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
            posterEl.appendChild(playBtn);

            posterEl.addEventListener("click", () => mountIframe(card, true));

            card.appendChild(posterEl);
            slide.appendChild(card);
            return slide;
        }

        function mountIframe(cardEl, autoplay = true) {
            cleanupIframesExceptActiveAndAdjacent();
            if (cardEl.querySelector("iframe") || cardEl.querySelector("video")) return;

            const src = cardEl.dataset.embed;
            const info = getEmbedInfo(src);
            const poster = cardEl.querySelector(".poster");
            if (poster) poster.remove();

            const controls = createControls();
            cardEl.appendChild(controls);

            const centerPlayPauseBtn = document.createElement("div");
            centerPlayPauseBtn.className = "center-play-pause-btn";
            centerPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            cardEl.appendChild(centerPlayPauseBtn);

            let player;

            if (info.type === "youtube") {
                const container = document.createElement("div");
                container.className = "player-iframe";
                cardEl.appendChild(container);

                player = new YT.Player(container, {
                    videoId: info.videoId,
                    playerVars: { autoplay: autoplay ? 1 : 0, rel: 0, playsinline: 1, controls: 0, modestbranding: 1 },
                    events: {
                        onReady: (event) => {
                            if (autoplay) event.target.playVideo();
                            setupControls(event.target, 'youtube', controls, centerPlayPauseBtn, cardEl);
                        },
                        onStateChange: (event) => {
                            const state = event.data;
                            if (state === YT.PlayerState.PLAYING) {
                                centerPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                                centerPlayPauseBtn.style.opacity = 0;
                            } else if (state === YT.PlayerState.PAUSED) {
                                centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                                centerPlayPauseBtn.style.opacity = 1;
                            } else {
                                centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                            }
                        }
                    }
                });
                players[src] = player;
            } else if (info.type === "mp4") {
                const video = document.createElement("video");
                video.className = "player-iframe";
                if (autoplay) video.setAttribute("autoplay", "true");
                video.setAttribute("playsinline", "true");
                video.style.width = "100%";
                video.style.height = "100%";
                video.style.background = "#000";

                const source = document.createElement("source");
                source.src = src;
                source.type = "video/mp4";
                video.appendChild(source);
                cardEl.appendChild(video);

                player = video;
                players[src] = player;

                video.addEventListener('loadedmetadata', () => {
                    setupControls(video, 'mp4', controls, centerPlayPauseBtn, cardEl);
                    if (!autoplay) video.pause();
                });
                video.addEventListener('play', () => {
                    centerPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    centerPlayPauseBtn.style.opacity = 0;
                });
                video.addEventListener('pause', () => {
                    centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                    centerPlayPauseBtn.style.opacity = 1;
                });
                video.addEventListener('ended', () => {
                    centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                    centerPlayPauseBtn.style.opacity = 1;
                });
            } else {
                const iframe = document.createElement("iframe");
                iframe.className = "player-iframe";
                iframe.setAttribute("allow", "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share");
                iframe.setAttribute("allowfullscreen", "true");
                iframe.src = src + (src.includes("?") ? "&" : "?") + (autoplay ? "autoplay=1" : "");
                cardEl.appendChild(iframe);
            }
        }

        function createControls() {
            const controlsBar = document.createElement("div");
            controlsBar.className = "controls-bar";

            const playPauseBtn = document.createElement("button");
            playPauseBtn.className = "play-pause-btn";
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';

            const progressBarContainer = document.createElement("div");
            progressBarContainer.className = "progress-bar";
            const progress = document.createElement("div");
            progress.className = "progress";
            progressBarContainer.appendChild(progress);

            const timeDisplay = document.createElement("div");
            timeDisplay.className = "time";
            timeDisplay.textContent = "00:00 / 00:00";

            const volumeControl = document.createElement("div");
            volumeControl.className = "volume-control";
            const volumeIcon = document.createElement("span");
            volumeIcon.className = "volume-icon";
            volumeIcon.innerHTML = '<i class="fas fa-volume-up"></i>';
            const volumeSlider = document.createElement("input");
            volumeSlider.type = "range";
            volumeSlider.min = "0";
            volumeSlider.max = "1";
            volumeSlider.step = "0.01";
            volumeSlider.value = "1";
            volumeControl.appendChild(volumeIcon);
            volumeControl.appendChild(volumeSlider);

            controlsBar.appendChild(playPauseBtn);
            controlsBar.appendChild(progressBarContainer);
            controlsBar.appendChild(timeDisplay);
            controlsBar.appendChild(volumeControl);

            return controlsBar;
        }


        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return [h, m, s]
                .filter(v => v > 0 || v === 0)
                .map(v => v.toString().padStart(2, '0'))
                .join(':')
                .replace(/^00:/, '');
        }

        function setupControls(player, type, controls, centerPlayPauseBtn, cardEl) {
            const playPauseBtn = controls.querySelector('.play-pause-btn');
            const progressBarContainer = controls.querySelector('.progress-bar');
            const progress = controls.querySelector('.progress');
            const volumeSlider = controls.querySelector('.volume-control input');
            const timeDisplay = controls.querySelector('.time');
            let totalTime = 0;
            let timeoutId;

            const hideControls = () => {
                controls.style.opacity = 0;
                if (type === 'youtube' && player.getPlayerState() === YT.PlayerState.PLAYING) {
                    centerPlayPauseBtn.style.opacity = 0;
                } else if (type === 'mp4' && !player.paused) {
                    centerPlayPauseBtn.style.opacity = 0;
                }
            };

            const showControls = () => {
                clearTimeout(timeoutId);
                controls.style.opacity = 1;
                centerPlayPauseBtn.style.opacity = 1;
                timeoutId = setTimeout(hideControls, 3000);
            };

            const updateTime = () => {
                let currentTime = 0;
                if (type === 'youtube') {
                    currentTime = player.getCurrentTime();
                } else {
                    currentTime = player.currentTime;
                }
                const progressPercentage = (currentTime / totalTime) * 100;
                progress.style.width = `${progressPercentage}%`;
                timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(totalTime)}`;
            };

            const interval = setInterval(updateTime, 1000);

            cardEl.addEventListener('mouseenter', showControls);
            cardEl.addEventListener('mouseleave', hideControls);
            cardEl.addEventListener('mousemove', showControls);

            if (type === 'youtube') {
                totalTime = player.getDuration();
                updateTime();
                playPauseBtn.onclick = () => {
                    const state = player.getPlayerState();
                    if (state === YT.PlayerState.PLAYING) {
                        player.pauseVideo();
                    } else {
                        player.playVideo();
                    }
                };
                centerPlayPauseBtn.onclick = playPauseBtn.onclick;
                progressBarContainer.onclick = (e) => {
                    const clickX = e.offsetX;
                    const totalWidth = progressBarContainer.clientWidth;
                    const newTime = (clickX / totalWidth) * totalTime;
                    player.seekTo(newTime, true);
                };
                volumeSlider.oninput = (e) => player.setVolume(e.target.value * 100);
            } else if (type === 'mp4') {
                totalTime = player.duration;
                updateTime();
                playPauseBtn.onclick = () => {
                    if (player.paused) {
                        player.play();
                    } else {
                        player.pause();
                    }
                };
                centerPlayPauseBtn.onclick = playPauseBtn.onclick;
                progressBarContainer.onclick = (e) => {
                    const clickX = e.offsetX;
                    const totalWidth = progressBarContainer.clientWidth;
                    const newTime = (clickX / totalWidth) * totalTime;
                    player.currentTime = newTime;
                };
                volumeSlider.oninput = (e) => player.volume = e.target.value;
                player.addEventListener('timeupdate', updateTime);
            }
        }

        function restorePoster(card) {
            const src = card.dataset.embed;
            const player = players[src];
            if (player) {
                if (typeof player.pauseVideo === 'function') {
                    player.pauseVideo();
                } else if (typeof player.pause === 'function') {
                    player.pause();
                }
            }

            const playerContainer = card.querySelector(".player-iframe");
            if (playerContainer) playerContainer.remove();

            const controlsBar = card.querySelector(".controls-bar");
            if (controlsBar) controlsBar.remove();

            const centerBtn = card.querySelector(".center-play-pause-btn");
            if (centerBtn) centerBtn.remove();

            if (!card.querySelector(".poster")) {
                const info = getEmbedInfo(src);
                const posterEl = document.createElement("div");
                posterEl.className = "poster";
                if (info.poster) {
                    posterEl.style.backgroundImage = `url("${info.poster}")`;
                }
                const playBtn = document.createElement("div");
                playBtn.className = "play-btn";
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                posterEl.appendChild(playBtn);
                posterEl.addEventListener("click", () => mountIframe(card, true));
                card.appendChild(posterEl);
            }
        }

        function cleanupIframesExceptActiveAndAdjacent() {
            if (!swiper) return;

            const activeIndex = swiper.activeIndex;
            const prevIndex = (activeIndex - 1 + swiper.slides.length) % swiper.slides.length;
            const nextIndex = (activeIndex + 1) % swiper.slides.length;

            swiper.slides.forEach((slide, index) => {
                if (index !== activeIndex && index !== prevIndex && index !== nextIndex) {
                    const card = slide.querySelector(".player-card");
                    if (card) {
                        const src = card.dataset.embed;
                        const player = players[src];
                        if (player) {
                            if (typeof player.pauseVideo === 'function') player.pauseVideo();
                            else if (typeof player.pause === 'function') player.pause();
                            delete players[src];
                        }
                        restorePoster(card);
                    }
                } else if (index !== activeIndex) {
                    const card = slide.querySelector(".player-card");
                    if (card) {
                        const src = card.dataset.embed;
                        const player = players[src];
                        if (player) {
                            if (typeof player.pauseVideo === 'function') player.pauseVideo();
                            else if (typeof player.pause === 'function') player.pause();
                            const centerPlayPauseBtn = card.querySelector('.center-play-pause-btn');
                            if (centerPlayPauseBtn) {
                                centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                                centerPlayPauseBtn.style.opacity = 1;
                            }
                        }
                    }
                }
            });
        }

        function updateFixedTitle(swiperInstance) {
            const fixedBox = document.getElementById("video-title-fixed");
            if (!fixedBox || !swiperInstance) return;

            const activeSlide = swiperInstance.slides[swiperInstance.activeIndex] || document.querySelector('.swiper-slide-active');
            if (!activeSlide) return;

            const newTitle = activeSlide.dataset.title || "Video";
            const newDesc = activeSlide.dataset.descripcion || "";

            const titleEl = fixedBox.querySelector(".video-title");
            const descEl = fixedBox.querySelector(".video-desc");

            const currentTitle = titleEl.querySelector('.text-container')?.textContent;
            const currentDesc = descEl.querySelector('.text-container')?.textContent;

            if (currentTitle === newTitle && currentDesc === newDesc) {
                return;
            }

            fixedBox.style.opacity = 0;

            setTimeout(() => {
                const setupExpandableText = (element, text, allowExpand = true) => {
                    element.innerHTML = "";
                    const container = document.createElement("span");
                    container.className = "text-container";
                    container.textContent = text;
                    element.appendChild(container);

                    setTimeout(() => {
                        if (!allowExpand) return;

                        const temp = container.cloneNode(true);
                        temp.style.display = "inline-block";
                        temp.style.webkitLineClamp = "unset";
                        temp.style.maxHeight = "none";
                        temp.style.visibility = "hidden";
                        element.appendChild(temp);

                        const needsClamp = temp.scrollHeight > container.clientHeight;
                        temp.remove();

                        if (needsClamp) {
                            element.querySelectorAll(".toggle-text").forEach(btn => btn.remove());
                            const toggleButton = document.createElement("span");
                            toggleButton.className = "toggle-text";
                            toggleButton.textContent = "...más";
                            element.appendChild(toggleButton);

                            const toggleExpand = () => {
                                const isExpanded = container.classList.contains("expanded");
                                if (isExpanded) {
                                    container.classList.remove("expanded");
                                    toggleButton.textContent = "...más";
                                } else {
                                    container.classList.add("expanded");
                                    toggleButton.textContent = "mostrar menos";
                                }
                            };

                            toggleButton.addEventListener("click", (e) => {
                                e.stopPropagation();
                                toggleExpand();
                            });
                            container.addEventListener("click", (e) => {
                                e.stopPropagation();
                                toggleExpand();
                            });
                        }
                    }, 50);
                };

                setupExpandableText(titleEl, newTitle, false);
                setupExpandableText(descEl, newDesc, true);
                fixedBox.style.opacity = 1;
            }, 120);
        }

        async function cargarVideos(checkNew = false) {
            const loader = document.getElementById("loader");
            if (!loader) return;

            if (!checkNew) loader.style.display = "flex";

            try {
                const res = await fetch(`${SCRIPT_URL}?accion=listar&tipo=videos`);
                const data = await res.json();

                const wrapper = document.getElementById("slides");
                if (!wrapper) {
                    console.error("❌ Error: Contenedor de slides no encontrado");
                    loader.style.display = "none";
                    return;
                }
                if (!checkNew) wrapper.innerHTML = "";

                let newVideos = [];
                if (Array.isArray(data.data)) {
                    data.data.forEach((row) => {
                        const titulo = row[0];
                        const link = row[1];
                        const descripcion = row[4] || "";
                        const id = row[5];
                        if (titulo && link && id) {
                            newVideos.push({ title: titulo, link, desc: descripcion, id });
                        }
                    });
                }

                if (!checkNew && newVideos.length > 0) {
                    const primerVideoId = newVideos[0].id;
                    await cargarComentarios(primerVideoId, true);
                    const videosRestantes = newVideos.slice(1);
                    if (videosRestantes.length > 0) {
                        Promise.all(videosRestantes.map(v => cargarComentarios(v.id, false)))
                            .catch(e => console.warn("Error precargando comentarios:", e));
                    }
                }

                if (!checkNew) {
                    newVideos.forEach(v => {
                        wrapper.appendChild(createSlide(v.title, v.link, v.desc, v.id));
                    });
                }

                if (checkNew) {
                    const linksActivos = newVideos.map(v => v.link);
                    const activeSlide = document.querySelector('.swiper-slide-active');
                    const activeLink = activeSlide ? activeSlide.querySelector('.player-card')?.dataset.embed : null;

                    Array.from(wrapper.children).forEach(slide => {
                        const card = slide.querySelector(".player-card");
                        if (card && !linksActivos.includes(card.dataset.embed)) {
                            if (slide === activeSlide) {
                                if (swiper) {
                                    swiper.removeSlide(swiper.activeIndex);
                                    swiper.slideNext(0);
                                }
                            } else {
                                wrapper.removeChild(slide);
                            }
                        }
                    });
                    if (swiper) swiper.update();
                }

                if (checkNew && lastVideos.length > 0) {
                    const nuevos = newVideos.filter(v => !lastVideos.find(old => old.link === v.link));
                    if (nuevos.length > 0) {
                        const validNuevos = nuevos.filter(v => v.title && v.link && v.id);
                        if (validNuevos.length > 0) {
                            notifications.unshift(...validNuevos);
                            renderNotifications();
                        }
                    }
                }

                lastVideos = newVideos;

                if (!checkNew) {
                    if (swiper) swiper.destroy(true, true);
                    swiper = new Swiper(".swiper", {
                        loop: true,
                        direction: "vertical",
                        slidesPerView: 1,
                        spaceBetween: 10,
                        pagination: false,
                        on: {
                            init() {
                                updateFixedTitle(this);
                                activarSwipeParaBorrar();
                                const videoId = getActiveVideoId();
                                if (videoId) renderComentarios(videoId);
                                const activeCard = this.slides[this.activeIndex].querySelector('.player-card');
                                if (activeCard && !activeCard.querySelector("iframe") && !activeCard.querySelector("video")) {
                                    mountIframe(activeCard, true);
                                }
                            },
                            slideChange() {
                                cleanupIframesExceptActiveAndAdjacent();
                                updateFixedTitle(this);
                                activarSwipeParaBorrar();
                                const videoId = getActiveVideoId();
                                if (videoId) {
                                    if (!comentariosPorVideo[videoId]) {
                                        cargarComentarios(videoId, true);
                                    } else {
                                        renderComentarios(videoId);
                                    }
                                }
                            },
                            slideChangeTransitionEnd() {
                                updateFixedTitle(this);
                                const activeIndex = this.activeIndex;
                                const prevIndex = (activeIndex - 1 + this.slides.length) % this.slides.length;
                                const nextIndex = (activeIndex + 1) % this.slides.length;

                                const activeCard = this.slides[activeIndex].querySelector('.player-card');
                                if (activeCard) {
                                    const src = activeCard.dataset.embed;
                                    if (!activeCard.querySelector("iframe") && !activeCard.querySelector("video")) {
                                        mountIframe(activeCard, true);
                                    } else {
                                        const player = players[src];
                                        if (player) {
                                            if (typeof player.playVideo === 'function') {
                                                player.playVideo();
                                            } else if (typeof player.play === 'function') {
                                                player.play().catch(e => console.warn("Error al reproducir:", e));
                                            }
                                            const centerPlayPauseBtn = activeCard.querySelector('.center-play-pause-btn');
                                            if (centerPlayPauseBtn) {
                                                centerPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                                                centerPlayPauseBtn.style.opacity = 0;
                                            }
                                        }
                                    }
                                }

                                const prevCard = this.slides[prevIndex].querySelector('.player-card');
                                if (prevCard && !prevCard.querySelector("iframe") && !prevCard.querySelector("video")) {
                                    mountIframe(prevCard, false);
                                } else if (prevCard) {
                                    const centerPlayPauseBtn = prevCard.querySelector('.center-play-pause-btn');
                                    if (centerPlayPauseBtn) {
                                        centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                                        centerPlayPauseBtn.style.opacity = 1;
                                    }
                                }

                                const nextCard = this.slides[nextIndex].querySelector('.player-card');
                                if (nextCard && !nextCard.querySelector("iframe") && !nextCard.querySelector("video")) {
                                    mountIframe(nextCard, false);
                                } else if (nextCard) {
                                    const centerPlayPauseBtn = nextCard.querySelector('.center-play-pause-btn');
                                    if (centerPlayPauseBtn) {
                                        centerPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                                        centerPlayPauseBtn.style.opacity = 1;
                                    }
                                }

                                const videoId = getActiveVideoId();
                                if (videoId && comentariosPorVideo[videoId]) {
                                    renderComentarios(videoId);
                                }
                            }
                        }
                    });

                    cleanupIframesExceptActiveAndAdjacent();
                    updateFixedTitle(swiper);
                    activarSwipeParaBorrar();
                    const videoId = getActiveVideoId();
                    if (videoId) renderComentarios(videoId);
                }
            } catch (e) {
                console.error("❌ Error cargando videos:", e);
            } finally {
                loader.style.display = "none";
            }
        }


        const comentariosCache = {};

        async function cargarComentarios(videoId, render = true, options = {}) {
            if (!videoId) return;

            const force = options.force || false;

            if (!force && comentariosCache[videoId]) {
                comentariosPorVideo[videoId] = comentariosCache[videoId];
                if (render) renderComentarios(videoId);
                return;
            }

            if (!force && comentariosPorVideo[videoId]) {
                comentariosCache[videoId] = comentariosPorVideo[videoId];
                if (render) renderComentarios(videoId);
                return;
            }

            try {
                const res = await fetch(
                    `${SCRIPT_URL}?accion=listarComentarios&videoId=${encodeURIComponent(videoId)}&_=${Date.now()}`
                );
                const data = await res.json();

                comentariosPorVideo[videoId] = Array.isArray(data.data)
                    ? data.data.map(c => ({
                        autor: c[2] || "Anónimo",
                        comentario: c[1] || "",
                        fecha: c[4] ? new Date(c[4]).toLocaleString() : "",
                        correo: c[3] || ""
                    }))
                    : [];

                comentariosCache[videoId] = comentariosPorVideo[videoId];

                if (render) renderComentarios(videoId);
            } catch (e) {
                console.error("Error cargando comentarios:", e);
                comentariosPorVideo[videoId] = [];
                comentariosCache[videoId] = [];
                if (render) renderComentarios(videoId);
            }
        }

        function renderComentarios(videoId) {
            if (!videoId) return;

            const lista = comentariosPorVideo[videoId] || [];
            const commentsList = document.getElementById('commentsList');
            const commentCountValue = document.getElementById('commentCountValue');

            if (!commentsList || !commentCountValue) {
                console.error("❌ Error: Contenedor de comentarios o contador no encontrado en el DOM");
                return;
            }

            let swipedData = null;
            const swipedComment = document.querySelector('li.swiped');
            if (swipedComment) {
                swipedData = {
                    texto: swipedComment.dataset.texto,
                    correo: swipedComment.dataset.correo
                };
            }

            commentsList.innerHTML = '';

            if (lista.length === 0) {
                commentsList.innerHTML = '<li>Sé el primero en comentar...</li>';
                commentCountValue.textContent = "0";
            } else {
                const comentariosInvertidos = [...lista].reverse();
                comentariosInvertidos.forEach(c => {
                    const li = document.createElement('li');
                    li.classList.add('deletable');

                    const commentContent = document.createElement('div');
                    commentContent.className = 'comment-content';
                    commentContent.textContent = `${c.autor} (${c.fecha}) - ${c.comentario}`;
                    li.appendChild(commentContent);

                    li.dataset.correo = c.correo;
                    li.dataset.texto = c.comentario;

                    if (normalizeText(c.correo) === normalizeText(usuarioCorreo)) {
                        const deleteBtnContainer = document.createElement('div');
                        deleteBtnContainer.className = 'delete-btn-container';
                        const deleteBtn = document.createElement('div');
                        deleteBtn.className = 'delete-btn';
                        deleteBtn.textContent = 'Borrar';
                        deleteBtnContainer.appendChild(deleteBtn);
                        li.appendChild(deleteBtnContainer);

                        deleteBtn.addEventListener('click', async (ev) => {
                            ev.stopPropagation();
                            await eliminarComentario(videoId, c.comentario, c.correo);
                            renderComentarios(videoId);
                        });
                    }

                    if (
                        swipedData &&
                        normalizeText(c.correo) === normalizeText(swipedData.correo) &&
                        c.comentario === swipedData.texto
                    ) {
                        li.classList.add('swiped');
                        commentContent.classList.add('swiped');
                        commentContent.style.transform = `translateX(100px)`;
                        const deleteBtnContainer = li.querySelector('.delete-btn-container');
                        if (deleteBtnContainer) {
                            deleteBtnContainer.classList.add('visible');
                            deleteBtnContainer.style.transform = `translateX(0)`;
                        }
                    }

                    commentsList.appendChild(li);
                });

                commentCountValue.textContent = lista.length;
            }

            if (window.restoreSwipeAfterRender) window.restoreSwipeAfterRender();
        }

        async function enviarComentario() {
            const texto = document.getElementById('commentInput').value.trim();
            const videoId = getActiveVideoId();
            if (!texto || !videoId) return;

            const sendCommentBtn = document.querySelector('.send-comment-btn');
            sendCommentBtn.disabled = true;

            try {
                const res = await fetch(SCRIPT_URL, {
                    method: "POST",
                    body: new URLSearchParams({
                        accion: "agregarComentarioVideo",
                        videoId,
                        comentario: texto,
                        autor: usuarioAutor,
                        correo: usuarioCorreo,
                    })
                });
                const data = await res.json();

                if (data.status === "success") {
                    document.getElementById('commentInput').value = "";
                    await cargarComentarios(videoId, true, { force: true });
                    ultimaActualizacionComentarios = String(Date.now());
                    notificarCambioComentarios();
                } else {
                    console.error("❌ No se pudo guardar:", data.message);
                }
            } catch (e) {
                console.error("Error al enviar comentario:", e);
            } finally {
                sendCommentBtn.disabled = false;
            }
        }

        async function eliminarComentario(videoId, comentario, correo) {
            if (!videoId || !comentario || !correo) return;

            try {
                const res = await fetch(SCRIPT_URL, {
                    method: "POST",
                    body: new URLSearchParams({
                        accion: "eliminarComentario",
                        videoId,
                        comentario,
                        correo
                    })
                });
                const data = await res.json();

                if (data.status === "success") {
                    await cargarComentarios(videoId, true, { force: true });
                    ultimaActualizacionComentarios = String(Date.now());
                    notificarCambioComentarios();
                } else {
                    console.error("❌ No se eliminó:", data.message);
                }
            } catch (e) {
                console.error("Error al eliminar comentario:", e);
            }
        }

        function getActiveVideoId() {
            if (!swiper) return null;
            const activeSlide = swiper.slides[swiper.activeIndex];
            if (!activeSlide) return null;
            return activeSlide.dataset.videoid || null;
        }

        async function precargarComentariosTodos(videos) {
            for (const v of videos) {
                await cargarComentarios(v.id, false);
            }
        }

        async function initSyncComentarios() {
            try {
                const res = await fetch(`${SCRIPT_URL}?accion=ultimaActualizacionComentarios&_=${Date.now()}`);
                const data = await res.json();
                ultimaActualizacionComentarios = data.timestamp || "";
            } catch (e) {
                console.warn("No se pudo inicializar sync de comentarios:", e);
            }
        }

        async function verificarComentariosVideos() {
            try {
                const res = await fetch(`${SCRIPT_URL}?accion=ultimaActualizacionComentarios&_=${Date.now()}`);
                const data = await res.json();

                if (data.timestamp && data.timestamp !== ultimaActualizacionComentarios) {
                    ultimaActualizacionComentarios = data.timestamp;
                    const videoIds = lastVideos.map(v => v.id);
                    for (const videoId of videoIds) {
                        await cargarComentarios(videoId, false, { force: true });
                    }
                    const videoIdActivo = getActiveVideoId();
                    if (videoIdActivo) {
                        renderComentarios(videoIdActivo);
                    }
                }
            } catch (err) {
                console.warn("No se pudo verificar comentarios:", err);
            }
        }

        function notificarCambioComentarios() {
            setTimeout(verificarComentariosVideos, 0);
        }

        setInterval(verificarComentariosVideos, 5000);

        function renderNotifications() {
            const list = document.getElementById("notification-list");
            const count = document.getElementById("notification-count");
            const notificationBtn = document.getElementById("notification-btn");
            const bellIcon = notificationBtn.querySelector("i");

            if (!list || !count || !notificationBtn || !bellIcon) {
                console.error("❌ Error: Elementos de notificaciones no encontrados en el DOM");
                return;
            }

            list.innerHTML = "";

            if (notifications.length === 0) {
                list.innerHTML = "<div>Sin notificaciones</div>";
                count.textContent = "";
                count.style.display = "none";
                bellIcon.className = "far fa-bell";
                try {
                    if (typeof AppInventor !== "undefined" && AppInventor.setWebViewString) {
                        AppInventor.setWebViewString("0");
                    }
                } catch (e) {
                    console.warn("No se pudo enviar a App Inventor:", e);
                }
                return;
            }

            count.textContent = notifications.length;
            count.style.display = "block";
            bellIcon.className = "fas fa-bell";

            notifications.forEach((notif, i) => {
                if (!notif || !notif.link || !notif.title || !notif.id) {
                    console.warn("⚠️ Notificación inválida detectada:", notif);
                    return;
                }

                const item = document.createElement("div");
                item.textContent = notif.title;
                item.style.cursor = "pointer";
                item.style.padding = "10px";
                item.style.userSelect = "none";

                item.onclick = () => {
                    notifications.splice(i, 1);
                    renderNotifications();
                    document.getElementById("notification-list").style.display = "none";
                    const wrapper = document.getElementById("slides");
                    if (!wrapper || !swiper) return;

                    const currentVideoId = getActiveVideoId();
                    if (currentVideoId && !comentariosPorVideo[currentVideoId]) {
                        cargarComentarios(currentVideoId, false, { force: true });
                    }

                    let slide = Array.from(wrapper.children).find(s => s.dataset.videoid === notif.id);
                    let isNewSlide = !slide;
                    let targetIndex = -1;

                    if (isNewSlide) {
                        const originalLoop = swiper.params.loop;
                        if (swiper.slides.length < 3) {
                            swiper.params.loop = false;
                            swiper.update();
                        }

                        const nuevoSlide = createSlide(notif.title, notif.link, notif.desc, notif.id);
                        swiper.appendSlide(nuevoSlide);
                        swiper.update();
                        swiper.loopFix();
                        targetIndex = swiper.slides.length - 1;
                        lastVideos.push({ title: notif.title, link: notif.link, desc: notif.desc, id: notif.id });
                        cargarComentarios(notif.id, false, { force: true });
                    } else {
                        targetIndex = swiper.slides.findIndex(s => s.dataset.videoid === notif.id);
                    }

                    if (targetIndex !== -1) {
                        setTimeout(() => {
                            cleanupIframesExceptActiveAndAdjacent();
                            swiper.slideToLoop(targetIndex, 500);
                            updateFixedTitle(swiper);

                            setTimeout(() => {
                                const activeCard = swiper.slides[swiper.activeIndex]?.querySelector('.player-card');
                                if (activeCard) {
                                    const src = activeCard.dataset.embed;
                                    if (!activeCard.querySelector("iframe") && !activeCard.querySelector("video")) {
                                        mountIframe(activeCard, true);
                                    } else {
                                        const player = players[src];
                                        if (player) {
                                            if (typeof player.playVideo === 'function') {
                                                player.playVideo();
                                            } else if (typeof player.play === 'function') {
                                                player.play().catch(e => console.warn("Error al reproducir:", e));
                                            }
                                        }
                                    }
                                }

                                const videoId = getActiveVideoId();
                                if (videoId) {
                                    if (!comentariosPorVideo[videoId] || comentariosPorVideo[videoId].length === 0) {
                                        cargarComentarios(videoId, true, { force: true });
                                    } else {
                                        renderComentarios(videoId);
                                    }
                                }
                            }, 300);
                        }, 500);
                    }
                };

                list.appendChild(item);
            });

            try {
                if (typeof AppInventor !== "undefined" && AppInventor.setWebViewString) {
                    AppInventor.setWebViewString(String(notifications.length));
                }
            } catch (e) {
                console.warn("No se pudo enviar a App Inventor:", e);
            }
        }

        document.getElementById("notification-btn").addEventListener("click", (e) => {
            e.stopPropagation();
            const notifList = document.getElementById("notification-list");
            notifList.style.display = notifList.style.display === "none" ? "block" : "none";
        });

        document.addEventListener("click", (e) => {
            const notifList = document.getElementById("notification-list");
            const notifBtn = document.getElementById("notification-btn");
            if (notifList.style.display !== "none" && !notifList.contains(e.target) && e.target !== notifBtn) {
                notifList.style.display = "none";
            }
        });

        function showToast(msg) {
            const toast = document.createElement("div");
            toast.textContent = msg;
            toast.style.position = "fixed";
            toast.style.bottom = "80px";
            toast.style.left = "50%";
            toast.style.transform = "translateX(-50%)";
            toast.style.background = "rgba(0,0,0,0.85)";
            toast.style.color = "white";
            toast.style.padding = "10px 16px";
            toast.style.borderRadius = "6px";
            toast.style.fontSize = "14px";
            toast.style.zIndex = "100000";
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        function setSavedVideos(data) {
            document.cookie = "savedVideos=" + encodeURIComponent(JSON.stringify(data)) + "; path=/; max-age=31536000";
        }

        function getSavedVideos() {
            const match = document.cookie.match(/(^| )savedVideos=([^;]+)/);
            return match ? JSON.parse(decodeURIComponent(match[2])) : [];
        }

        function saveCurrentVideo() {
            if (!swiper || lastVideos.length === 0) {
                showToast("⚠️ No hay videos para guardar");
                return;
            }

            const currentIndex = swiper.realIndex;
            const currentVideo = lastVideos[currentIndex];

            let saved = getSavedVideos();

            if (!saved.find(item => item.id === currentVideo.id)) {
                saved.push({
                    id: currentVideo.id,
                    titulo: currentVideo.title || currentVideo.desc || "Video sin título",
                    desc: currentVideo.desc || ""
                });
                setSavedVideos(saved);
                showToast("✅ Video guardado");
            } else {
                showToast("ℹ️ Este video ya está guardado");
            }
        }

        function renderSavedVideos(filter = "") {
            const saved = getSavedVideos();
            const savedList = document.getElementById("savedList");
            savedList.innerHTML = "";

            const filtered = saved.filter(item =>
                normalizeText(item.titulo).includes(normalizeText(filter))
            );

            const buttonsContainer = document.createElement("div");
            buttonsContainer.style.display = "flex";
            buttonsContainer.style.justifyContent = "space-between";
            buttonsContainer.style.gap = "10px";
            buttonsContainer.style.margin = "8px 0 10px";

            const saveCurrentBtn = document.createElement("button");
            saveCurrentBtn.textContent = "💾 Guardar actual";
            saveCurrentBtn.style.flex = "1";
            saveCurrentBtn.style.background = "#007bff";
            saveCurrentBtn.style.color = "#fff";
            saveCurrentBtn.style.border = "none";
            saveCurrentBtn.style.borderRadius = "6px";
            saveCurrentBtn.style.padding = "6px 12px";
            saveCurrentBtn.style.cursor = "pointer";
            saveCurrentBtn.style.fontSize = "13px";

            saveCurrentBtn.addEventListener("click", () => {
                saveCurrentVideo();
                renderSavedVideos(filter);
            });

            buttonsContainer.appendChild(saveCurrentBtn);

            if (filtered.length > 1) {
                const clearAllBtn = document.createElement("button");
                clearAllBtn.textContent = "Eliminar todo";
                clearAllBtn.style.flex = "1";
                clearAllBtn.style.background = "#2c2c2c";
                clearAllBtn.style.color = "#ccc";
                clearAllBtn.style.border = "1px solid #444";
                clearAllBtn.style.borderRadius = "6px";
                clearAllBtn.style.padding = "6px 12px";
                clearAllBtn.style.cursor = "pointer";
                clearAllBtn.style.fontSize = "13px";

                clearAllBtn.addEventListener("click", () => {
                    setSavedVideos([]);
                    renderSavedVideos();
                    showToast("✅ Todos los videos fueron eliminados");
                });

                buttonsContainer.appendChild(clearAllBtn);
            }

            savedList.appendChild(buttonsContainer);

            if (filtered.length === 0) {
                const emptyMsg = document.createElement("li");
                emptyMsg.textContent = "No hay videos guardados";
                emptyMsg.style.color = "#777";
                emptyMsg.style.padding = "10px";
                savedList.appendChild(emptyMsg);
                document.getElementById("savedModalInner").style.transform = "translateY(-60px)";
            } else {
                document.getElementById("savedModalInner").style.transform = "translateY(0)";
            }

            filtered.forEach(item => {
                const li = document.createElement("li");
                li.style.display = "flex";
                li.style.justifyContent = "space-between";
                li.style.alignItems = "center";
                li.style.padding = "10px";
                li.style.borderBottom = "1px solid #333";
                li.style.color = "#fff";

                const titleSpan = document.createElement("span");
                titleSpan.textContent = item.titulo;
                titleSpan.style.cursor = "pointer";
                titleSpan.style.flex = "1";

                titleSpan.addEventListener("click", () => {
                    const videoIndex = lastVideos.findIndex(v => v.id === item.id);
                    if (videoIndex !== -1) {
                        swiper.slideToLoop(videoIndex, 0, false);
                        document.getElementById("savedModal").style.display = "none";
                    } else {
                        showToast("⚠️ Este video ya no está disponible");
                    }
                });

                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "✕";
                deleteBtn.style.background = "transparent";
                deleteBtn.style.border = "none";
                deleteBtn.style.color = "#aaa";
                deleteBtn.style.fontSize = "14px";
                deleteBtn.style.cursor = "pointer";
                deleteBtn.style.marginLeft = "10px";

                deleteBtn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    const updated = saved.filter(s => s.id !== item.id);
                    setSavedVideos(updated);
                    renderSavedVideos(filter);
                    showToast("🗑️ Eliminado de guardados");
                });

                li.appendChild(titleSpan);
                li.appendChild(deleteBtn);
                savedList.appendChild(li);
            });
        }

        document.getElementById("saveBtn").addEventListener("click", () => {
            document.getElementById("savedModal").classList.toggle("hidden");
            renderSavedVideos();
        });

        document.getElementById("closeSavedBtn").addEventListener("click", () => {
            document.getElementById("savedModal").classList.add("hidden");
        });

        document.getElementById("savedSearchInput").addEventListener("input", (e) => {
            renderSavedVideos(e.target.value);
        });

        let pendingDelete = null;

        document.getElementById("btn-delete").onclick = () => {
            if (!swiper) return;
            const activeSlide = document.querySelector(".swiper-slide-active");
            if (!activeSlide) return;

            const title = activeSlide.dataset.title;
            const link = activeSlide.querySelector(".player-card")?.dataset.embed;

            if (!usuarioAutor || !usuarioCorreo) {
                showToast("⚠️ No se pudo obtener la información de tu cuenta.");
                return;
            }

            pendingDelete = { title, link };
            document.getElementById("delete-video-title").text



            document.getElementById("btn-delete").onclick = () => {
        if (!swiper) return;
        const activeSlide = document.querySelector(".swiper-slide-active");
        if (!activeSlide) return;

        const title = activeSlide.dataset.title;
        const link = activeSlide.querySelector(".player-card")?.dataset.embed;
        const videoId = activeSlide.dataset.videoid;

        if (!usuarioAutor || !usuarioCorreo) {
            showToast("⚠️ No se pudo obtener la información de tu cuenta.");
            return;
        }

        pendingDelete = { title, link, videoId };
        document.getElementById("delete-video-title").textContent = `¿Estás seguro de que deseas eliminar "${title}"?`;
        document.getElementById("delete-modal").classList.remove("hidden");

        document.getElementById("delete-confirm").onclick = async () => {
            if (!pendingDelete || !pendingDelete.link || !pendingDelete.videoId) return;

            const loader = document.getElementById("loader");
            if (loader) loader.style.display = "flex";

            try {
                const res = await fetch(SCRIPT_URL, {
                    method: "POST",
                    body: new URLSearchParams({
                        accion: "eliminarVideo",
                        link: pendingDelete.link,
                        correo: usuarioCorreo,
                        videoId: pendingDelete.videoId
                    })
                });
                const data = await res.json();

                if (data.status === "success") {
                    showToast("✅ Video eliminado correctamente");
                    document.getElementById("delete-modal").classList.add("hidden");
                    const saved = getSavedVideos();
                    const updated = saved.filter(s => s.id !== pendingDelete.videoId);
                    setSavedVideos(updated);
                    await cargarVideos(true);
                } else {
                    showToast("❌ No se pudo eliminar: " + data.message);
                }
            } catch (e) {
                console.error("Error al eliminar video:", e);
                showToast("❌ Error al intentar eliminar el video");
            } finally {
                if (loader) loader.style.display = "none";
                pendingDelete = null;
            }
        };

        document.getElementById("delete-cancel").onclick = () => {
            document.getElementById("delete-modal").classList.add("hidden");
            pendingDelete = null;
        };
    };

    document.getElementById("publishSubmit").onclick = async () => {
        const title = document.getElementById("videoTitle").value.trim();
        const link = document.getElementById("videoLink").value.trim();
        const description = document.getElementById("videoDescription").value.trim();

        if (!title || !link) {
            showToast("⚠️ Por favor, completa el título y el enlace del video");
            return;
        }

        const loader = document.getElementById("loader");
        if (loader) loader.style.display = "flex";

        try {
            const res = await fetch(SCRIPT_URL, {
                method: "POST",
                body: new URLSearchParams({
                    accion: "agregarVideo",
                    titulo: title,
                    link,
                    descripcion: description,
                    autor: usuarioAutor,
                    correo: usuarioCorreo
                })
            });
            const data = await res.json();

            if (data.status === "success") {
                showToast("✅ Video publicado correctamente");
                document.getElementById("videoTitle").value = "";
                document.getElementById("videoLink").value = "";
                document.getElementById("videoDescription").value = "";
                closeAllModals();
                await cargarVideos(true);
            } else {
                showToast("❌ No se pudo publicar: " + data.message);
            }
        } catch (e) {
            console.error("Error al publicar video:", e);
            showToast("❌ Error al intentar publicar el video");
        } finally {
            if (loader) loader.style.display = "none";
        }
    };

    function normalizeText(text) {
        return text
            ? text
                  .toString()
                  .toLowerCase()
                  .normalize("NFD")
                  .replace(/[\u0300-\u036f]/g, "")
            : "";
    }

            ¡Gracias por señalarlo! Me quedé en la Parte 10, donde el código se cortó en medio de la función de eliminación de videos. A continuación, continúo desde ese punto, completando el código restante para que tengas la implementación completa de tu requerimiento. Dividiré el resto en partes adicionales (Partes 11 a 13) para mantener la organización y respetar las limitaciones de tamaño. Estas partes incluirán el final de la función de eliminación, las funciones de publicación de videos, inicialización de la aplicación, y cualquier ajuste final necesario para que los modales y botones funcionen como solicitaste.
Resumen del Contexto

Objetivo: Completar el código combinado que incluye un encabezado con botones (Imágenes, Videos, Publicar) que abren modales en lugar de redirigir a enlaces separados. El modal de videos ya incluye el carrusel de videos (Swiper) del segundo código proporcionado. Los modales de imágenes y publicación son placeholders, esperando el código de imágenes si lo proporcionas.
Estado Actual: Las primeras 10 partes cubren el HTML del encabezado, modales, estilos CSS, y la mayor parte del JavaScript para videos, comentarios, notificaciones y guardado. Falta completar la función de eliminación de videos, la lógica de publicación, inicialización, y ajustes finales.
Enfoque: Completaré el código desde donde se cortó (document.getElementById("btn-delete").onclick) y añadiré las funciones restantes, asegurando que los botones del encabezado abran modales, resalten el botón seleccionado, y manejen el contenido correspondiente.


Parte 11: Finalización de la Función de Eliminación y Publicación
Esta parte completa la función de eliminación de videos que se cortó en la Parte 10 y añade la lógica para publicar nuevos videos en el modal de publicación.
html<script>
    document.getElementById("btn-delete").onclick = () => {
        if (!swiper) return;
        const activeSlide = document.querySelector(".swiper-slide-active");
        if (!activeSlide) return;

        const title = activeSlide.dataset.title;
        const link = activeSlide.querySelector(".player-card")?.dataset.embed;
        const videoId = activeSlide.dataset.videoid;

        if (!usuarioAutor || !usuarioCorreo) {
            showToast("⚠️ No se pudo obtener la información de tu cuenta.");
            return;
        }

        pendingDelete = { title, link, videoId };
        document.getElementById("delete-video-title").textContent = `¿Estás seguro de que deseas eliminar "${title}"?`;
        document.getElementById("delete-modal").classList.remove("hidden");

        document.getElementById("delete-confirm").onclick = async () => {
            if (!pendingDelete || !pendingDelete.link || !pendingDelete.videoId) return;

            const loader = document.getElementById("loader");
            if (loader) loader.style.display = "flex";

            try {
                const res = await fetch(SCRIPT_URL, {
                    method: "POST",
                    body: new URLSearchParams({
                        accion: "eliminarVideo",
                        link: pendingDelete.link,
                        correo: usuarioCorreo,
                        videoId: pendingDelete.videoId
                    })
                });
                const data = await res.json();

                if (data.status === "success") {
                    showToast("✅ Video eliminado correctamente");
                    document.getElementById("delete-modal").classList.add("hidden");
                    const saved = getSavedVideos();
                    const updated = saved.filter(s => s.id !== pendingDelete.videoId);
                    setSavedVideos(updated);
                    await cargarVideos(true);
                } else {
                    showToast("❌ No se pudo eliminar: " + data.message);
                }
            } catch (e) {
                console.error("Error al eliminar video:", e);
                showToast("❌ Error al intentar eliminar el video");
            } finally {
                if (loader) loader.style.display = "none";
                pendingDelete = null;
            }
        };

        document.getElementById("delete-cancel").onclick = () => {
            document.getElementById("delete-modal").classList.add("hidden");
            pendingDelete = null;
        };
    };

    document.getElementById("publishSubmit").onclick = async () => {
        const title = document.getElementById("videoTitle").value.trim();
        const link = document.getElementById("videoLink").value.trim();
        const description = document.getElementById("videoDescription").value.trim();

        if (!title || !link) {
            showToast("⚠️ Por favor, completa el título y el enlace del video");
            return;
        }

        const loader = document.getElementById("loader");
        if (loader) loader.style.display = "flex";

        try {
            const res = await fetch(SCRIPT_URL, {
                method: "POST",
                body: new URLSearchParams({
                    accion: "agregarVideo",
                    titulo: title,
                    link,
                    descripcion: description,
                    autor: usuarioAutor,
                    correo: usuarioCorreo
                })
            });
            const data = await res.json();

            if (data.status === "success") {
                showToast("✅ Video publicado correctamente");
                document.getElementById("videoTitle").value = "";
                document.getElementById("videoLink").value = "";
                document.getElementById("videoDescription").value = "";
                closeAllModals();
                await cargarVideos(true);
            } else {
                showToast("❌ No se pudo publicar: " + data.message);
            }
        } catch (e) {
            console.error("Error al publicar video:", e);
            showToast("❌ Error al intentar publicar el video");
        } finally {
            if (loader) loader.style.display = "none";
        }
    };

    function normalizeText(text) {
        return text
            ? text
                  .toString()
                  .toLowerCase()
                  .normalize("NFD")
                  .replace(/[\u0300-\u036f]/g, "")
            : "";
    }
</script>
Explicación:

Eliminación de Videos: Completa la lógica del botón de eliminación (btn-delete). Al hacer clic, muestra un modal de confirmación con el título del video. Si se confirma, envía una solicitud POST al servidor para eliminar el video, actualiza la lista de videos y elimina el video de los guardados si estaba presente.
Publicación de Videos: Añade la lógica para el botón "Publicar" en el modal de publicación. Valida que el título y el enlace no estén vacíos, envía los datos al servidor, y recarga los videos si la publicación es exitosa.
Función Auxiliar: normalizeText se usa para normalizar cadenas de texto (por ejemplo, correos electrónicos) eliminando acentos y convirtiendo a minúsculas.


Parte 12: Funciones de Swipe para Comentarios y Configuración de Swiper
Esta parte incluye la lógica para permitir el deslizamiento ("swipe") en comentarios para eliminarlos y ajustes adicionales para el carrusel de videos.
html<script>
    function activarSwipeParaBorrar() {
        const comments = document.querySelectorAll("#commentsList li.deletable");
        comments.forEach(comment => {
            comment.addEventListener("touchstart", (e) => {
                if (activeComment && activeComment !== comment) {
                    const content = activeComment.querySelector(".comment-content");
                    const deleteContainer = activeComment.querySelector(".delete-btn-container");
                    if (content && deleteContainer) {
                        content.classList.remove("swiped");
                        content.style.transform = "";
                        deleteContainer.classList.remove("visible");
                        deleteContainer.style.transform = "";
                    }
                }
                startX = e.touches[0].clientX;
                isSwiping = true;
                activeComment = comment;
            });

            comment.addEventListener("touchmove", (e) => {
                if (!isSwiping || activeComment !== comment) return;
                const currentX = e.touches[0].clientX;
                const diffX = startX - currentX;
                const content = comment.querySelector(".comment-content");
                const deleteContainer = comment.querySelector(".delete-btn-container");
                if (!content || !deleteContainer) return;

                if (diffX > 0 && diffX <= 100) {
                    content.style.transform = `translateX(${diffX}px)`;
                    deleteContainer.style.transform = `translateX(${diffX - 100}px)`;
                }
            });

            comment.addEventListener("touchend", () => {
                if (!isSwiping || activeComment !== comment) return;
                const content = comment.querySelector(".comment-content");
                const deleteContainer = comment.querySelector(".delete-btn-container");
                if (!content || !deleteContainer) return;

                const diffX = parseFloat(content.style.transform.replace("translateX(", "").replace("px)", "")) || 0;
                if (diffX > 50) {
                    content.classList.add("swiped");
                    content.style.transform = `translateX(100px)`;
                    deleteContainer.classList.add("visible");
                    deleteContainer.style.transform = `translateX(0)`;
                } else {
                    content.classList.remove("swiped");
                    content.style.transform = "";
                    deleteContainer.classList.remove("visible");
                    deleteContainer.style.transform = "";
                    activeComment = null;
                }
                isSwiping = false;

                window.restoreSwipeAfterRender = () => {
                    content.classList.add("swiped");
                    content.style.transform = `translateX(100px)`;
                    deleteContainer.classList.add("visible");
                    deleteContainer.style.transform = `translateX(0)`;
                };
            });
        });
    }

    document.getElementById("commentsCounter").addEventListener("click", () => {
        const overlay = document.getElementById("commentsOverlay");
        const inputContainer = document.querySelector(".comment-input-container");
        if (!overlay || !inputContainer) return;

        if (overlay.classList.contains("hidden-overlay")) {
            overlay.classList.remove("hidden-overlay");
            inputContainer.classList.remove("hidden-overlay");
            overlay.classList.toggle("expanded");
        } else {
            overlay.classList.toggle("expanded");
        }
    });

    document.getElementById("commentInput").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
            e.preventDefault();
            enviarComentario();
        }
    });

    document.querySelector(".send-comment-btn").addEventListener("click", enviarComentario);
   async function init() {
        const loader = document.getElementById("loader");
        if (loader) loader.style.display = "flex";

        try {
            if (typeof AppInventor !== "undefined" && AppInventor.getWebViewString) {
                const userData = AppInventor.getWebViewString();
                if (userData) {
                    const [correo, nombre] = userData.split("|");
                    usuarioCorreo = correo || "";
                    usuarioAutor = nombre || "Anónimo";
                }
            }
        } catch (e) {
            console.warn("No se pudo obtener datos de usuario desde App Inventor:", e);
        }

        try {
            await initSyncComentarios();
            await cargarVideos();
            document.getElementById("refreshBtn").addEventListener("click", async () => {
                const loader = document.getElementById("loader");
                if (loader) loader.style.display = "flex";
                await cargarVideos(true);
                if (loader) loader.style.display = "none";
            });
        } catch (e) {
            console.error("Error durante la inicialización:", e);
            showToast("❌ Error al cargar la aplicación");
        } finally {
            if (loader) loader.style.display = "none";
        }
    }

    window.addEventListener("load", init);

    // Asegurar que solo un modal esté abierto y el botón correspondiente esté seleccionado
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeAllModals();
            }
        });
    });

    // Estilo adicional para modales
    const style = document.createElement('style');
    style.textContent = `
        #publishModal input, #publishModal textarea {
            width: 100%;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        #publishModal textarea {
            min-height: 100px;
            resize: vertical;
        }
        .modal-content h2, .modal-content h3 {
            margin-top: 0;
            color: #fff;
        }
        #custom-alert-modal p, #delete-modal p {
            color: #ddd;
        }
        .modal-actions button {
            transition: background 0.2s ease;
        }
        #publishSubmit, #delete-confirm {
            background: #007bff;
            color: #fff;
        }
        #publishCancel, #delete-cancel, #custom-alert-ok {
            background: #444;
            color: #fff;
        }
        #publishSubmit:hover, #delete-confirm:hover {
            background: #0056b3;
        }
        #publishCancel:hover, #delete-cancel:hover, #custom-alert-ok:hover {
            background: #555;
        }
    `;
    document.head.appendChild(style);

    // Inicializar videos al abrir la página
    document.getElementById('videosBtn').click();
</script>
</body>
</html>
