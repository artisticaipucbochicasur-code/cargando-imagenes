<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Luces ESP32</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #5ee7df, #b490ca);
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: #333;
  }
  h1 {
    font-size: 26px;
    margin-bottom: 20px;
    color: #fff;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  #connectBtn {
    background: #4e54c8;
    border: none;
    color: white;
    padding: 14px 30px;
    border-radius: 30px;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    transition: 0.3s;
  }
  #connectBtn:hover {
    background: #8f94fb;
    transform: scale(1.05);
  }
  .led-container {
    margin-top: 30px;
    display: flex;
    gap: 20px;
  }
  .switch {
    width: 100px;
    height: 100px;
    background: #ffffff22;
    border-radius: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    backdrop-filter: blur(5px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
  }
  .switch.on {
    background: #00c853;
    box-shadow: 0 0 20px rgba(0,200,83,0.5);
  }
  .switch:active {
    transform: scale(0.95);
  }
</style>
</head>
<body>

  <h1>üí° Control Bluetooth ESP32</h1>
  <button id="connectBtn" onclick="connectBluetooth()">üîó Conectar</button>

  <div class="led-container">
    <div id="led1" class="switch" onclick="toggleLed(1)">LED 1<br>OFF</div>
    <div id="led2" class="switch" onclick="toggleLed(2)">LED 2<br>OFF</div>
    <div id="led3" class="switch" onclick="toggleLed(3)">LED 3<br>OFF</div>
  </div>

<script>
let device;
let server;
let service;
let characteristic;
let leds = {1: false, 2: false, 3: false};

async function connectBluetooth() {
  try {
    device = await navigator.bluetooth.requestDevice({
      filters: [{ name: 'ESP32_Luces_BLE' }],
      optionalServices: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e']
    });

    server = await device.gatt.connect();
    service = await server.getPrimaryService('6e400001-b5a3-f393-e0a9-e50e24dcca9e');
    characteristic = await service.getCharacteristic('6e400002-b5a3-f393-e0a9-e50e24dcca9e');

    alert("‚úÖ Conectado a " + device.name);
    document.getElementById("connectBtn").innerText = "üîå Conectado";
    document.getElementById("connectBtn").disabled = true;
  } catch (error) {
    alert("‚ùå Error o cancelado: " + error);
  }
}

async function sendCommand(cmd) {
  if (!characteristic) {
    alert("‚ö†Ô∏è Con√©ctate primero al ESP32");
    return;
  }
  try {
    const data = new TextEncoder().encode(cmd);
    await characteristic.writeValue(data);
    console.log("‚úÖ Comando enviado:", cmd);
  } catch (error) {
    console.error("‚ùå Error al enviar:", error);
  }
}

function toggleLed(num) {
  leds[num] = !leds[num];
  const el = document.getElementById("led" + num);
  el.classList.toggle("on");
  el.innerHTML = `LED ${num}<br>${leds[num] ? "ON" : "OFF"}`;

  const cmd = leds[num] ? String.fromCharCode(64 + num) : String.fromCharCode(96 + num);
  sendCommand(cmd);
}
</script>

</body>
</html>

