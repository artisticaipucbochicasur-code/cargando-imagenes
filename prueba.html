<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- PWA y Iconos para Android e iOS -->
    <link rel="manifest" href="manifest.json">

    <!-- Iconos para Android (Chrome) -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
    <link rel="icon" type="image/png" href="/icon-192.png" sizes="192x192" onerror="console.log('Error cargando icon-192.png')">

    <!-- Meta tags para iOS (Safari) -->
    <link rel="apple-touch-icon" href="/apple-icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DECOM">

    <!-- Meta para color de barra de estado en Android/iOS -->
    <meta name="theme-color" content="#111111">
    <meta name="mobile-web-app-capable" content="yes">

    <title>DECOM - Fotos y Videos</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #111;
            color: #fff;
            overflow-x: hidden;
        }
        #socialHeader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 10001;
            padding: 8px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            opacity: 1 !important;
            pointer-events: auto !important;
        }
        #socialHeader h1 {
            margin: 0;
            font-size: 24px;
            text-align: center;
            color: #fff;
        }
        #socialHeader nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 5px;
        }
        #socialHeader a {
            color: #fff;
            text-decoration: none;
            font-size: 16px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        #socialHeader a.active {
            background: #fff;
            color: #111;
        }
        .swiper {
            width: 100%;
            height: 100vh;
            margin-top: 80px; /* Espacio para el header */
        }
        .swiper-slide {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #222;
        }
        .player-card, .image-card {
            width: 90%;
            height: 80%;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        .poster {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .play-btn {
            font-size: 50px;
            color: #fff;
            cursor: pointer;
        }
        .hidden-overlay {
            display: none !important;
        }
        /* ... (agrega otros estilos de sliderVideos.html aquí) ... */
    </style>
</head>
<body>
    <header id="socialHeader">
        <h1>DECOM</h1>
        <nav>
            <a href="#" class="tab-link active" data-tab="fotos">Imágenes</a>
            <a href="#" class="tab-link" data-tab="videos">Videos</a>
            <a href="#" id="publishBtn">Publicar</a>
        </nav>
    </header>

    <div class="swiper">
        <div id="slides" class="swiper-wrapper"></div>
    </div>

    <!-- Otras secciones (comentarios, notificaciones, etc.) de sliderVideos.html aquí -->

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw.../exec"; // Reemplaza con tu URL
        let swiper = null;
        let currentTab = "fotos";
        let lastVideos = [];
        let comentariosPorVideo = {};
        let players = {};

        // Inicializar tabs
        document.querySelectorAll('.tab-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                currentTab = link.getAttribute('data-tab');
                cargarContenido();
            });
        });

        // Función para cargar contenido según la pestaña
        async function cargarContenido() {
            const wrapper = document.getElementById("slides");
            if (!wrapper) return;
            wrapper.innerHTML = "";
            if (swiper) swiper.destroy(true, true);

            if (currentTab === "fotos") {
                await cargarFotos();
            } else if (currentTab === "videos") {
                await cargarVideos();
            }
        }

        // Cargar fotos (simplificado, ajusta según tu lógica de fotos.html)
        async function cargarFotos() {
            try {
                const res = await fetch(`${SCRIPT_URL}?accion=listar&tipo=fotos`);
                const data = await res.json();
                const wrapper = document.getElementById("slides");
                if (Array.isArray(data.data)) {
                    data.data.forEach((row) => {
                        const titulo = row[0];
                        const link = row[1];
                        if (titulo && link) {
                            const slide = document.createElement("div");
                            slide.className = "swiper-slide";
                            const card = document.createElement("div");
                            card.className = "image-card";
                            const img = document.createElement("img");
                            img.src = link;
                            img.style.width = "100%";
                            img.style.height = "100%";
                            img.style.objectFit = "contain";
                            card.appendChild(img);
                            slide.appendChild(card);
                            wrapper.appendChild(slide);
                        }
                    });
                }
                initSwiper();
            } catch (e) {
                console.error("Error cargando fotos:", e);
            }
        }

        // Cargar videos (usando la lógica de sliderVideos.html)
        async function cargarVideos() {
            const loader = document.getElementById("loader");
            if (!loader) console.error("❌ Error: Elemento loader no encontrado en el DOM");
            loader.style.display = "flex";

            try {
                const res = await fetch(`${SCRIPT_URL}?accion=listar&tipo=videos`);
                const data = await res.json();
                const wrapper = document.getElementById("slides");
                wrapper.innerHTML = "";

                let newVideos = [];
                if (Array.isArray(data.data)) {
                    data.data.forEach((row) => {
                        const titulo = row[0];
                        const link = row[1];
                        const descripcion = row[4] || "";
                        const id = row[5];
                        if (titulo && link && id) {
                            newVideos.push({ title: titulo, link, desc: descripcion, id });
                        }
                    });
                }

                newVideos.forEach(v => {
                    wrapper.appendChild(createSlide(v.title, v.link, v.desc, v.id));
                });

                lastVideos = newVideos;
                initSwiper();
            } catch (e) {
                console.error("❌ Error cargando videos:", e);
            } finally {
                loader.style.display = "none";
            }
        }

        // Crear slide (adaptado de sliderVideos.html)
        function createSlide(titulo, link, descripcion, id) {
            const { embedSrc, poster } = getEmbedInfo(link);
            const slide = document.createElement("div");
            slide.className = "swiper-slide";
            slide.dataset.title = titulo || "Video";
            slide.dataset.descripcion = descripcion || "";
            slide.dataset.videoid = id || "";

            const card = document.createElement("div");
            card.className = "player-card";
            card.dataset.embed = embedSrc;

            const posterEl = document.createElement("div");
            posterEl.className = "poster";
            if (poster) posterEl.style.backgroundImage = `url("${poster}")`;
            const playBtn = document.createElement("div");
            playBtn.className = "play-btn";
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
            posterEl.appendChild(playBtn);
            posterEl.addEventListener("click", () => mountIframe(card, true));
            card.appendChild(posterEl);
            slide.appendChild(card);

            return slide;
        }

        // getEmbedInfo y mountIframe (copiados de sliderVideos.html)
        function getEmbedInfo(link) {
            const url = new URL(link, location.href);
            if (url.hostname.includes("youtube.com") || url.hostname.includes("youtu.be")) {
                let videoId = url.searchParams.get("v") || url.pathname.replace("/", "");
                if (videoId) {
                    const embedSrc = `https://www.youtube.com/embed/${videoId}?rel=0&playsinline=1&controls=0&modestbranding=1`;
                    const poster = "https://img.youtube.com/vi/" + videoId + "/hqdefault.jpg";
                    return { type: "youtube", embedSrc, poster, videoId };
                }
            }
            if (url.hostname.includes("archive.org")) {
                let identifier = url.pathname.match(/\/(?:embed|details|download)\/([^?&#/]+)/i)?.[1] || "";
                const poster = identifier ? `https://archive.org/services/img/${identifier}` : "";
                return { type: "mp4", embedSrc: link, poster };
            }
            if (url.pathname.endsWith(".mp4")) {
                return { type: "mp4", embedSrc: link, poster: "" };
            }
            return { type: "other", embedSrc: link, poster: "" };
        }

        function mountIframe(cardEl, autoplay = true) {
            cleanupIframesExceptActiveAndAdjacent();
            if (cardEl.querySelector("iframe") || cardEl.querySelector("video")) return;
            const src = cardEl.dataset.embed;
            const info = getEmbedInfo(src);
            const poster = cardEl.querySelector(".poster");
            if (poster) poster.remove();
            const controls = createControls();
            cardEl.appendChild(controls);
            const centerPlayPauseBtn = document.createElement("div");
            centerPlayPauseBtn.className = "center-play-pause-btn";
            centerPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            cardEl.appendChild(centerPlayPauseBtn);
            let player;
            if (info.type === "youtube") {
                const container = document.createElement("div");
                container.className = "player-iframe";
                cardEl.appendChild(container);
                player = new YT.Player(container, {
                    videoId: info.videoId,
                    playerVars: { autoplay: autoplay ? 1 : 0, rel: 0, playsinline: 1, controls: 0, modestbranding: 1 },
                    events: {
                        onReady: (event) => { if (autoplay) event.target.playVideo(); setupControls(event.target, 'youtube', controls, centerPlayPauseBtn, cardEl); },
                        onStateChange: (event) => { /* ... */ }
                    }
                });
                players[src] = player;
            } else if (info.type === "mp4") {
                const video = document.createElement("video");
                video.className = "player-iframe";
                if (autoplay) video.setAttribute("autoplay", "true");
                video.setAttribute("playsinline", "true");
                video.style.width = "100%";
                video.style.height = "100%";
                video.style.background = "#000";
                const source = document.createElement("source");
                source.src = src;
                source.type = "video/mp4";
                video.appendChild(source);
                cardEl.appendChild(video);
                player = video;
                players[src] = player;
                video.addEventListener('loadedmetadata', () => { setupControls(video, 'mp4', controls, centerPlayPauseBtn, cardEl); if (!autoplay) video.pause(); });
            } else {
                const iframe = document.createElement("iframe");
                iframe.className = "player-iframe";
                iframe.setAttribute("allow", "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share");
                iframe.setAttribute("allowfullscreen", "true");
                iframe.setAttribute("title", "Video");
                iframe.src = src + (src.includes("?") ? "&" : "?") + (autoplay ? "autoplay=1" : "");
                cardEl.appendChild(iframe);
            }
        }

        // createControls, setupControls, etc. (copiados de sliderVideos.html)
        function createControls() {
            const controlsBar = document.createElement("div");
            controlsBar.className = "controls-bar";
            const playPauseBtn = document.createElement("button");
            playPauseBtn.className = "play-pause-btn";
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            const progressBarContainer = document.createElement("div");
            progressBarContainer.className = "progress-bar";
            const progress = document.createElement("div");
            progress.className = "progress";
            progressBarContainer.appendChild(progress);
            const timeDisplay = document.createElement("div");
            timeDisplay.className = "time";
            timeDisplay.textContent = "00:00 / 00:00";
            const volumeControl = document.createElement("div");
            volumeControl.className = "volume-control";
            const volumeIcon = document.createElement("span");
            volumeIcon.className = "volume-icon";
            volumeIcon.innerHTML = '<i class="fas fa-volume-up"></i>';
            const volumeSlider = document.createElement("input");
            volumeSlider.type = "range";
            volumeSlider.min = "0";
            volumeSlider.max = "1";
            volumeSlider.step = "0.01";
            volumeSlider.value = "1";
            volumeControl.appendChild(volumeIcon);
            volumeControl.appendChild(volumeSlider);
            controlsBar.appendChild(playPauseBtn);
            controlsBar.appendChild(progressBarContainer);
            controlsBar.appendChild(timeDisplay);
            controlsBar.appendChild(volumeControl);
            return controlsBar;
        }

        function setupControls(player, type, controls, centerPlayPauseBtn, cardEl) {
            // ... (copia la lógica de sliderVideos.html) ...
        }

        function initSwiper() {
            if (swiper) swiper.destroy(true, true);
            swiper = new Swiper(".swiper", {
                loop: true,
                direction: "vertical",
                slidesPerView: 1,
                spaceBetween: 10,
                on: {
                    init() { /* ... */ },
                    slideChange() { /* ... */ }
                }
            });
        }

        // Iniciar con fotos por defecto
        window.addEventListener("load", () => {
            cargarContenido();
        });
    </script>
</body>
</html>
